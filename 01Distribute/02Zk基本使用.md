## 安装和配置
**单机模式**
1. 下载解压
2. conf 目录下创建一个配置文件 zoo.cfg
3. 启动zk的server
只运行在一台服务器上，适合测试环境。zk的启动脚本在bin下。启动之前的几个基本配置有：
- tickTime:该时间是作为zk服务器之间或者客户端与服务器之间维持心跳的时间间隔。也就是在每个tickTime就会发送一个心跳。
- dataDir: 即zk保存数据的目录。默认zk会将写数据的的日志文件也保存在这个目录里。
- clientPort: 客户端连接zk服务器的端口，zk会监听该端口接受客户端的访问请求。
**集群模式**
1. 创建myid文件，server1机器内容为1，server2机器内容为2
2. conf下创建配置文件zoo.cfg
    ```
    tickTime=2000
    dataDir=/data
    dataLogDir=/logDir
    clientPort=2181
    initLimit=5
    syncLimit=2
    server.1=server1:2888:3888
    server.2=server2:2888:3888
    ```
zk不仅可以提供单机服务，也同时支持多个机器组成集群来提供服务。实际上zk还支持另外一种伪集群的方式，也就是说可以在一台物理机上运行多个zk实例。
initLimit:这个配置是 zk 接受客户端（这里所说的客户端不是用户连接zk服务器的客户端，而是zk服务器集群中连接到leader的Follower服务器）初始化连接时最长能忍受多少个心跳时间间隔数，当已经超过了5个心跳的时间长度后zk还没接受到客户端的返回信息，那么就表明这个客户端连接失败。
syncLimit:这个配置项标识Leader和Follower之间发送消息，请求和应答的时间长度。最长不能超过多少个tickTime
server.A=B:C:D 其中A是一个数字，标识这是第几号服务器。B是这个服务器的ip地址，C是这个服务器与集群中的Leader服务器交换信息的端口。D标识万一集群中的服务器挂了，需要一个端口来重新进行选举，选出一个新的leader，这个端口就是用来执行选举时服务器相互通信的端口。如果是伪集群的方式，由于B都是一样的，所以不同zk实例通信端口不能一样。要给他们分配不同的端口号。
除了修改zoo.cgf文件，集群模式下还有一个myid文件，该文件在dataDir下。该文件中有一个数据就是A的值。zk启动时会读取这个文件。拿到里面的信息与zoo.cfg里面的配置信息对比判断到底是哪个server。
**伪集群模式**
。。。
## zk的数据模型
- 层次化目录结构，命名符合常规文件系统规范
- 每个节点在zk中叫做znode，并且有一个唯一标识
- znode可以包含数据和子节点。但是暂存性的节点不能有子节点。
- znode数据可以有多个版本，比如某一路径下存有多个数据版本，那么查询这个路径下的数据就要带上版本号
- 节点不支持部分读写，而是一次性完整读写。（原子操作？）。客户端可以在节点上设置监视器
- znode 可以被监控，，包括这个目录中节点存储数据的修改，子节点目录变化等。一旦变化可以通知设置监控的客户端。这个功能是zk对于应用最重要的特性。通过这个特性可以实现的功能包括 **配置的集中管理，集群管理，分布式锁等**
